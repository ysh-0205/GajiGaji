<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>리뷰 상세페이지</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <!-- 별점 스타일 추가 -->
    <style>
        .rating-stars {
            direction: rtl;
            unicode-bidi: bidi-override;
            display: inline-block;
        }
        .rating-stars input {
            display: none;
        }
        .rating-stars label {
            font-size: 2em;
            color: #ddd;
            cursor: pointer;
            padding: 0 5px;
        }
        .rating-stars label:before {
            content: '★';
        }
        .rating-stars input:checked ~ label {
            color: #ffc107;
        }
        .rating-stars label:hover,
        .rating-stars label:hover ~ label {
            color: #ffc107;
        }
        .star-rating {
            font-size: 1.25rem;
            color: #ffc107;
        }
    </style>
</head>
<body>

    {% include 'Toon/nav.html' %}
    <!-- Product section-->
    <section class="py-5">
      <div class="container px-4 px-lg-5 my-5">
        <div class="row gx-4 gx-lg-5 align-items-center">

          <!-- 이미지 영역 -->
          <div class="col-md-6">
            {% if post.uploaded_image %}
              <img src="{{ post.uploaded_image.url }}"
                   alt="{{ post.title }}"
                   style="width: 100%; height: 700px; object-fit: cover;"
                   class="img-fluid" />
            {% else %}
              <img src="https://dummyimage.com/600x700/dee2e6/6c757d.jpg"
                   alt="No image"
                   style="width: 100%; height: 700px; object-fit: cover;"
                   class="img-fluid" />
            {% endif %}
          </div>

          <!-- 텍스트 영역 -->
          <div class="col-md-6">
                {% if user.is_authenticated and post.author == user %}
                    <a class="btn btn-primary" href="/Toon/{{ post.pk }}/update">글 수정</a>
                    <a class="btn btn-primary" href="/Toon/{{ post.pk }}/delete">글 지우기</a>
                {% endif %}
            <h1 class="display-5 fw-bolder">{{post.title}}</h1>

            <!-- 별점 표시 및 폼 추가 -->
            <div class="d-flex align-items-center mb-3">
                {% if avg_rating > 0 %}
                    <span class="star-rating me-2">⭐ {{ avg_rating|floatformat:1 }}</span>
                {% else %}
                    <span class="text-muted me-2">아직 별점이 없습니다.</span>
                {% endif %}
                <!-- 별점 입력 폼 -->
                <form action="{% url 'Toon_detail' pk=post.pk %}" method="post" class="d-flex">
                    {% csrf_token %}
                    <div class="rating-stars">
                        <input type="radio" id="star5" name="rating" value="5" /><label for="star5" title="5점"></label>
                        <input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="4점"></label>
                        <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="3점"></label>
                        <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="2점"></label>
                        <input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="1점"></label>
                    </div>
                    <button type="submit" class="btn btn-sm btn-outline-primary ms-3">별점 제출</button>
                </form>
            </div>
            <!-- /별점 표시 및 폼 -->

            {% if post.Categorytype or post.Categorygenre %}
                <a class="badge bg-secondary text-decoration-none link-light"  href="#!">
                    {{ post.Categorytype.name }}
                </a>
              <a class="badge bg-secondary text-decoration-none link-light" href="#!">
                    {{ post.Categorygenre.name }}
                </a>
            {% else %}
                <a class="badge bg-secondary text-decoration-none link-light" href="#!">미분류</a>
            {% endif %}
            <div class="fs-5 mb-5"></div>
            <p class="lead">
                {{post.content}}
            </p>
          </div>

        </div>
      </div>
        <!--갤러리-->
        <div class="container my-5">
        <h4>하이라이트 갤러리</h4>
        <div class="row">
            {% for image in highlight_images %}
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="card h-100">
                    <img class="card-img-top" src="{{ image.image.url }}" alt="Highlight Image"
                         style="object-fit: cover; height: 200px; cursor: pointer;"
                         data-bs-toggle="modal" data-bs-target="#imageModal-{{ forloop.counter }}" >
                </div>
            </div>

            <div class="modal fade" id="imageModal-{{ forloop.counter }}" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-body text-center">
                            <img src="{{ image.image.url }}" class="img-fluid" alt="원본 이미지">
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <p>하이라이트 이미지가 없습니다.</p>
            {% endfor %}
        </div>
    </div>


        <div class="row">
            <div class="col-lg-8">
                </div>
            <div class="col-lg-4">
                </div>
        </div>
    </div>

       <section class="mb-5">
            <div class="card bg-light" style="max-width: 1300px; margin: 0 auto;">
                <div class="card-body" >
                    <h3>댓글 목록</h3>


                            {% for comment in comments %}

                            <div class="border-bottom mb-2 pb-2">
                                <p><strong>{{ comment.author }}</strong> • {{ comment.created_date|date:"Y-m-d H:i" }}<span> </span>
                                    {% if user.is_authenticated and comment.author == user %}
                                        <a href="{% url 'Toon_updatecomment' comment.pk %}" class="btn btn-sm btn-outline-secondary text-white" style="background-color: darkseagreen" >수정</a>
                                        <a href="{% url 'Toon_deletecomment' comment.pk %}" class="btn btn-sm btn-outline-secondary text-white" style="background-color: #c06360">삭제</a></p>
                                    {% endif %}
                                <p>{{ comment.content }}</p>


                            </div>

                            {% empty %}
                                 <p>아직 댓글이 없습니다.</p>
                            {% endfor %}
                            <hr>

                    <h3>댓글 작성</h3>
                            <form method="POST" action="{% url 'Toon_createcomment' post.pk %}">
                                {% csrf_token %}
                                {{ commentform.content }}
                                <br>
                                <button type="submit" class="btn btn-primary mt-2">제출</button>
                            </form>
                </div>
            </div>
        </section>



        <div class="container px-4 px-lg-5 mt-5" style="max-width: 1200px;">
        <h2 class="mb-4" style="white-space: nowrap; word-break: normal;">추천 웹툰</h2>
        <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-4 justify-content-center">
          {% for post in random_post %}
          <div class="col mb-5">
            <a href="{% url 'Toon_detail' post.pk %}" class="text-decoration-none text-dark">
              <div class="card h-100">
                {% if post.uploaded_image %}
                <img class="card-img-top" src="{{ post.uploaded_image.url }}" alt="{{ post.title }}" style="height: 200px; object-fit: cover;" />
                {% else %}
                <img class="card-img-top" src="https://dummyimage.com/450x300/dee2e6/6c757d.jpg" alt="No image" />
                {% endif %}
                <div class="card-body p-4 text-center">
                  <h5 class="fw-bolder">{{ post.title }}</h5>
                </div>
              </div>
            </a>
          </div>
          {% empty %}
          <p>추천할 웹툰이 없습니다.</p>
          {% endfor %}
        </div>
      </div>
    </section>





    {% include 'Toon/footer.html' %}





    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
</body>
</html>
